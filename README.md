# FLaNK-Halifax

Community over Code, Apache NiFi, Apache Kafka, Apache Flink, Python, GTFS, Transit, Open Source, Open Data



#### Halifax Data

https://data-hrm.hub.arcgis.com/pages/open-data-downloads


#### Halifax GTFS Feeds

https://gtfs.halifax.ca/realtime/TripUpdate/TripUpdates.pb

https://gtfs.halifax.ca/realtime/Alert/Alerts.pb

https://gtfs.halifax.ca/realtime/Vehicle/VehiclePositions.pb

#### Apache Iceberg Table

````

CREATE TABLE default.halifaxalerts
(
  stopsequence string,
  arrivaltime string,
  stopid string,
  tripid string,
  tripstartdate string,
  departuretime string,
  ts string,
  uuid string,
  route_long_name string,
  stop_name string
)
PARTITIONED BY (triprouteid string) STORED BY ICEBERG;

````

#### FLaNK Projects

* https://github.com/tspannhw/gtfs
* https://github.com/tspannhw/spring-pulsar-discord
* https://github.com/tspannhw/pulsar-chatgptgenerated-functions
* https://github.com/tspannhw/pulsar-transit-function
* https://github.com/tspannhw/spring-pulsar-gtfsrealtime
  

#### Resources

* https://towardsdatascience.com/python-for-gtfs-segment-frequencies-in-a-map-4dc3bc1e26ff
* https://medium.com/swlh/python-for-transit-get-the-most-out-of-your-gtfs-with-this-python-package-44d0b732f657
* https://developers.google.com/transit/gtfs-realtime/examples/python-sample
* https://github.com/BlinkTagInc/gtfs-to-geojson
* https://gtfs.org/realtime/feed-entities/trip-updates/
* https://gtfs.org/realtime/reference/
* https://github.com/Bondify/gtfs_functions
* https://developers.google.com/transit/gtfs-realtime/reference
* https://github.com/timescale/examples/tree/master/mta
* https://github.com/OneBusAway/onebusaway-gtfs-realtime-trip-updates-producer-demo
* https://github.com/Cornell-Tech-Urban-Tech-Hub/BusObservatory-Grabber
* https://github.com/HSLdevcom/transitdata
* https://github.com/transitland/transitland-atlas
* https://github.com/MobilityData/mobility-database-catalogs
* https://github.com/CUTR-at-USF/awesome-transit/tree/master

#### Halifax

https://github.com/transitland/transitland-atlas/blob/master/feeds/gtfs.halifax.ca.dmfr.json

https://dmfr.transit.land/json-schema/dmfr.schema-v0.5.0.json


#### Other Feeds

* https://www.sfmta.com/reports/gtfs-transit-data

#### Lookup Table Autogenerated by Apache NiFi

````

-- public.halifaxlookupstops definition

-- Drop table

-- DROP TABLE public.halifaxlookupstops;

CREATE TABLE public.halifaxlookupstops (
	stop_id int4 NOT NULL,
	stop_code int4 NULL,
	stop_name text NULL,
	stop_desc text NULL,
	stop_lat float8 NULL,
	stop_lon float8 NULL,
	zone_id text NULL,
	stop_url text NULL,
	location_type text NULL,
	parent_station int4 NULL,
	stop_timezone text NULL,
	wheelchair_boarding int4 NULL,
	CONSTRAINT halifaxlookupstops_pkey PRIMARY KEY (stop_id)
);


-- public.halifaxlookuproutes definition

-- Drop table

-- DROP TABLE public.halifaxlookuproutes;

CREATE TABLE public.halifaxlookuproutes (
	route_id int4 NOT NULL,
	agency_id text NULL,
	route_short_name int4 NULL,
	route_long_name text NULL,
	route_desc text NULL,
	route_type int4 NULL,
	route_url text NULL,
	route_color text NULL,
	route_text_color int4 NULL,
	CONSTRAINT halifaxlookuproutes_pkey PRIMARY KEY (route_id)
);

````


### Install

https://github.com/MobilityData/gtfs-realtime-bindings/blob/master/python/README.md

pip3 install --upgrade gtfs-realtime-bindings


### Halifax Updates

````

{"stopsequence":"14","arrivaltime":"1693171354","stopid":"7409","tripid":"19776082","tripstartdate":"20230827","departuretime":"1693171354","triprouteid":"1","ts":"1693170735188","uuid":"f9aabf1b-777d-4ec5-a2b3-c17a10ed6281","route_long_name":"Spring Garden","stop_name":"7409"}


````

### Halifax Alerts

````

[{"routeid4":"","routeid5":"","descriptionlang":"en","cause":"CONSTRUCTION","stopid":"6179","alertlang":"en","alerttext":"Stop closure St Margarets Bay Rd Before Sheppards Run (6179) is closed for construction","routeid":"21","effect":"STOP_MOVED","stopid5":"","descriptiontext":"Stop Closure Notice:\r\nRoute: 21 Timberlea Outbound\r\nLocation: St Margarets Bay Rd Before Sheppards Run (6179)\r\nCause:  Stop Closed Construction\r\n\r\nAffected Stops:\r\nSt Margarets Bay Rd Before Sheppards Run (6179)","stopid4":"","activeperiodend":"32503694400","stopid3":"","stopid2":"","routeid2":"","routeid3":"","activeperiodstart":"1668085020","ts":"1693172857104","uuid":"359a677f-7f58-41e8-857b-c9257e608756"}]

````

### Halifax Vehicle Positions

````
[{"route_id":"5","route_long_name":"Portland","bearing":"90.0","directionid":"","latitude":44.66741,"tripid":"19774411","startdate":"20230827","uuid":"5b11bc27-07eb-49c6-b259-79d2da40ca12","speed":"6.7056","vehiclelabel":"1389","vehicleid":3389.0,"longitude":-63.57438,"timestamp":1693108357,"ts":1693108383603}]

````
